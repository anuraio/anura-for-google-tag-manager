___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Anura Solutions, LLC",
  "brand": {
    "id": "github.com_anuraio",
    "displayName": "anuraio",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Anura for Google Tag Manager is an Ad Fraud solution designed to accurately eliminate fraudulent users and improve conversion rates.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "instanceID",
    "displayName": "Instance ID",
    "simpleValueType": true,
    "help": "Your assigned Instance ID",
    "valueValidators": [
      {
        "type": "NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "source",
    "displayName": "Source",
    "simpleValueType": true,
    "help": "Source and campaign parameters may not equal the following values: \"all sources\", \"all campaigns\", \"\u0026\", \"*\", \"?\", \"%\"",
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "campaign",
    "displayName": "Campaign",
    "simpleValueType": true,
    "help": "Source and campaign parameters may not equal the following values: \"all sources\", \"all campaigns\", \"\u0026\", \"*\", \"?\", \"%\"",
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "callback",
    "displayName": "Optional Callback Function",
    "simpleValueType": true,
    "help": "callback functions are allowed to start with: \"$\", \"_\", or \"a-z\" characters, followed by \"a-z\" and \"0-9\" characters.",
    "canBeEmptyString": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^$|^[_$a-zA-Z][_$a-zA-Z0-9]*$"
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const getReferrerUrl = require('getReferrerUrl');
const EUC = require('encodeUriComponent');
const Math = require('Math');
const generateRandom = require('generateRandom');
const fromBase64 = require('fromBase64');
const getUrl = require('getUrl');
const instance_id = data.instanceID;
const source = data.source;
const campaign = data.campaign;
const callback = data.callback;
var url = 'https://script.anura.io/request.js';

var rF = getReferrerUrl();
//var aU = navigator.userAgent;
var lC = getUrl('host');
var eR = frEnc('Vm0wd2QyUXlWa2hWV0doVlYwZDRWMVl3Wkc5V01WbDNXa2M1V0ZKc2JETlhhMUpUVmpBeFdHVkdXbFppVkZaeVdWZHplRll4WkhGUmJGWlhZbFV3ZUZadGVGWmxSbGw1VTJ0V1ZXSklRbGhXYlhoM1ZWWmtWMXBFVWxwV01VcEpWbTEwYTJGR1NuUlZiR2hWVmtWd2RscFdXbXRXTVdSelYyMTRVMkpXU2twV2JHUXdWakZhV0ZOcmJGSmlSMmhZV1d4b2IwMHhXbGRYYlhSWVVqRktTVnBGV2xOVWJGcDFVV3BXVjFJemFHaFhWbVJIVmpGT2RWUnNhR2hsYlhoWlYxZDRiMVV3TUhoV2JrcFlZbFZhV0ZsclpGTmxWbGw1WlVWT1YwMXJWak5aTUZwVFZqRmFWMk5HVG1GU1JWcEVWbGQ0UTFaVk1VVk5SREE5', 11);

//place this frEnc Function between the first and second function ( Above this -> function anuraResponseHandler(response))

function frEnc(y, p) {
  var b = y;
  for (var i = 0; i < p; i++) { b = fromBase64(b); }
  return b;
}

if(data.hasOwnProperty("instanceID")) {
  url = url + '?instance=' + EUC(instance_id);
}
if(data.hasOwnProperty("source") && source) {
  if(source != "") {
    url = url + "&source=" + EUC(source);
  }
}
if(data.hasOwnProperty("campaign") && campaign) {
  if(campaign != "") {
    url = url + "&campaign=" + EUC(campaign);
  }
}
if(data.hasOwnProperty("callback")) {
  if(callback != "") {
    url = url + "&callback=" + EUC(callback);
  }
}

const cacheBuster = generateRandom(111111111111, 9999999999999999);
url = url + "&" + cacheBuster;

function onSuccess() {
  data.gtmOnSuccess();
}
function onFailure () {
  data.gtmOnFailure();
}
if (queryPermission('inject_script', url) && instance_id) {
  if (rF.indexOf(eR) !== -1 || lC.indexOf(eR) !== -1) {
      data.gtmOnSuccess();
    } else {
      injectScript(url, onSuccess, onFailure);
    }
} else {
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://script.anura.io/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test 1
  code: |-
    const mockData = {
      // Mocked field values
      "instance_id":"2227668113",
      "source":"mysource",
      "campaign":"mycampaign",
      "callback":"mycallbackfunction"
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    //assertApi('gtmOnSuccess').wasCalled(); //cannnot use this line to test as instances are referrer locked this specific instance id is locked to vincentkahn.com/testing_tag/ and successfully runs on my sample site http://vincentkahn.com/testing_tag/basic.html
setup: ''


___NOTES___

Created on 5/26/2020, 8:25:37 AM


