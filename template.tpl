___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1.01,
  "securityGroups": [],
  "displayName": "Anura Solutions, LLC",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAACQCAYAAADnRuK4AAAACXBIWXMAACE3AAAhNwEzWJ96AAAKkElEQVR4nO2dXWwcVxmG33XtxWs73myzZpq/rpMQLZWIlFSAECA1vkYiBYkLKqE4SAUhFeNIqOQCai8C1AokIrhDlXCFRIWQkHJRBOIC58IXrQQYGqCu02IncdKR17XH3r+stx70rWeSrWfXHu/ZMz9nvkfKzZ61d3b85Mw775zdiZmmCYZply7ec4wILBAjBAvECMECMUKwQIwQLBAjBAvECMECMUKwQIwQLBAjBAvECMECMUKwQIwQLBAjBAvECMECMUKwQIwQLFALRmYwOjKDhdi1+r/R5s9ieEnrDkZmcB7AJICnaGQ6/2D8Oj1uXsC044ciDAtkMTKDYUuci42PNwhk84ol0oJjJIJEXqCRGRwEMA5gwjHYXCCbHICr5gWsOUYiRKQzEOUcoD6TNJVnD+hnIp+PIjkDWTlnCkDGMbiDXWagRhYBjEYxH0VKICvnTNkB2Q0uBbK5bokUmXwUCYGsnHN1Z0B2wz4FsqGgPR6FfKR8BhqZqZ9ZLbQjjwAXrXw06eFr+oKyM5AVkCfd5JzdaHMGamTROu2fcowogHIC7SwCRemAQDZKFpHKCNSqCBSlgwLZKFVEhl6gvYpAUSQIZKNEERlqgaycQ2dXScdgB/iChvJcAXh5EQlJb8GwztZCm49CKdB+isB2OJsEfvhxGAe6t8Vc3YTx5TeQlDgbhbaIDJVA7RSB++GxjwA/egL5U/1IN/uxfxrIP/0G0gslx1CnCF0RGQqBRIpANwx0A1dOQ//co9DcPP/ae9BH/w5tbdMx1ClCU0QGXiCrCByXlXO+kYHxlaOId8f2l3OqWyj//B1Ur/xHznZZ+YhCdqDLyMAK1KkisBUUkL85jKqdc9qF8tHz/0ZcYtAOdBEZOIE6XQTuhALy2EnoJ/rcHa7ccmMd+rffhCYxaAeyiAyMQLKKQBsKyM+ddJ9z2oXy0fib0CQG7UAVkb4LJLsIpID8zFEYXz0mLas05aV5GC/OIykxaAeiiPRVIC+KwO+cRKynC72OQQ+4v4XKc/+CqXIR6YtAXheBfqNyEempQH4XgX6jYhHpiUBBKwL9RqUiUrpAQS0C/UaVIlK6QD94C2vvFBG/V+nsH7hTRWAraibKv19C9VYZuHwK8XiXHEGlFZEmytgoVc2v9R10jHUQ6QLl5lB/geIH0OcL4tO2rCKwkZn3ob84D61Q214PdLAHmHoS+oXH5L1mR4vI0n0dKxsatkyYY0Mxx3gH8Uwgm3wV+s0itMoHjqfuihdF4P9K0H/yNrSbxYePNf5BSd7fPAn9E4PytkGoiNys6chvaKjWHjyknEA2t8owbpWQrDUdfYgXReBGDcYLbyE5aziGmq5IPJ8G/vBpGKkeedu0ryJyyzSwbCRRcT5ZWYFQf9+ozBdhtspHsotAyjkvLyL2u6XWv7+ZQDbf/RgqP34Cpqx8tGcRSTlnrRjDeqnl9istkE3NhHFj/eH/Ni+KwFfvwPjtEpKFmmPoQ+wmEEH56MppGN87LW9bmxaR6yUDRilJ/wt3IxIC2VDQ/tYwIDMgzxrIvzSP9Hv3HUNNcRtqh/uAX59D/nxaXolJQfvMa/eB1aKGmrsQKVugbscjPtL/CLQTfXJenwLyL96FNmvI+QNT6B2ZQZry0S/PyAna9d+5vO543E+U/2gzBeSf3UT56/+oyyMdmrHO/BXas7Mo06HH7/cvG2UFooBMOeeZvyH5mt4ihEqEgu/JvyBJZ1PUOnv9+l6hpEBUBH7pDSR+tbh3SJYJnRTQpQrtT0hQv+PflshDKYEo5zw7C3z/v9stclAgkZ5+Hdq56e0gHJwtE0cJgSjnXL4BUM5pbJGDBmUwykcjM9un5sHdUveEXqBX76D4xdebt8hBhYL2o39E8vkbZrFQKIQ6H4VeoLeL6P/8IRhU6IWK9ZLx0+mV/pWVlcTt27eNSqUSsjewjRKHsO4YktRef/Ig8r2POIaDRWUzj6X3qQx80CJvbW0ldV3HvXv38rVagMKbC5QK0QPdSH8mVS/c9G6p/Wsb0JVyfQ3Q19KtWuRqtZpeWlrC8vKyvrW15RgPIoFqojtFOg7ts4dQvlNG9d2izwvr6Ur5aiGOQsV1M10qlbRyuVw+cOBANZVKBeKDAa1QUiBsT62JxxNIHOmFIWNF5J5YKwLdXPBshmmaifX19UShUDBSqVR8YGAgkEt2lb+UQfkoO4DEp1LQPQvatCLwTj7RmHPahfIRBe27d+/qQQzakbnVAV2opaBN+Uha0Kacc28VWF7XRMVx/OrNTY2CdtBQ9hDWCspH6bj7FZGueLgiMBQfK+okkRPI5vEEksd6d18RuScPVwQGOujKJLICEV0x9GYHgFP9H14R6QqXKwJVh295ud8iskkRGGVYoAZ2LSJdFIFRhAVqgl1EnuyHUQ/IKxtl3F3Vmn1sJuqEPgONfXTV2NjYiFPx5hgUI4FeJF5Ief2OwkXoZyCq+o8dO5bo6+tTcsVf0FHiENbV1YWhoSHt8OHD6OnpYZE8RKkMFI/HceTIEU3TNJJK+U9EBAElQ3Rvby+OHz+eTKVSlVgspuwnIoKA0mdhg4ODvZSPBgcHeTaShPKn8ZSPKGgfPXqUZiZ5X3MZUSLTA3V3d0PTtDTlIw7anSNyRSLlIwrahw4dKnPQFif0RWJuzvGQS2iF396r/Cb/vOx4rJMsXJD3nb9ewJcyGCFYIEYIFogRggVihGCBGCFYIEYIFogRggVihGCBGCFYIEYIFogRggVihGCBGCFYIEYIFogRggVihGCBGCG8EChn3YKa8RbD2vdSkS7QRLZ+3/Jh62b4jDfQvh42x4ak3jMeXh3CJrJYm8hiFMA5ANcdT2A6Be3bc+bY0Kg5NrTmxV71dFH9RBazdNPj3BzOA5gCkHE8iWmHRQAkzbTXe8+XED2RxfREtn5Yu8z5SAjad5fNsaFhP+SB32dhE1lctfKR9LCnIDkr51z18635fhpv5SMKeyc4aLuC9tEJCshe5ZzdCMwHCyeyWKDjuJWNSKinHE+KNhSQJ/06VLUiiEUi7SAK2ZescBh1aB9cymQy5zOZTKDkQcCbaJqJzka4iLSLwLOZTGbKMRoQgn4pY806nEWtiKwXgZlMZjKTyfiec3YjLNfC1qx8pHoRWS8CM5nMaNDFsQnbt3PMWvlItSKyXgQGMePsRVivxk9bh7VLIc9HhhWQh8MoDxRYzjEV4iIyZ+WcwAZkN8RMU40bhuTm6iJRK3vBMSiAhC+YugZg3BwbWnCMhBBlBLKxLtR2rIjsoECBLAJFUU4gm9xc/axtUjRod0CgRUucUB+qWqHsktaJrO9F5IMiUFV5oPIM1EhuDgetfHTRMbgHbc5Ar1g5JxRdjgiREMgmN1efka7uJx/tU6DrljizjhFFiZRANvtZEelSIN9WBPpNJAWyyc1h3AraLe+6vIdAhhWQfV3U5SeR/lyY4IrIQKwI9JtIz0CNtCoim8xAShWBorBAO9hZRDYIpGQRKAoL1AK7iLQEUrYIFIUFYoTgL1dghGCBGCFYIEYIFogRggVihGCBGCFYIEYIFogRggVihGCBGCFYIEYIFogRggVihGCBGCFYIEYIFogRggVi2gfA/wHsy4QuwDjElQAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "An Ad Fraud solution designed to accurately eliminate fraud to improve conversion rates. With this plug in, you can easily set up a real-time visitor firewall to keep the fraud off of your site.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "instanceID",
    "displayName": "Instance ID",
    "simpleValueType": true,
    "help": "Your assigned Instance ID",
    "valueValidators": [
      {
        "type": "NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "source",
    "displayName": "Source",
    "simpleValueType": true,
    "help": "Source and campaign parameters may not equal the following values: \"all sources\", \"all campaigns\", \"\u0026\", \"*\", \"?\", \"%\"",
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "campaign",
    "displayName": "Campaign",
    "simpleValueType": true,
    "help": "Source and campaign parameters may not equal the following values: \"all sources\", \"all campaigns\", \"\u0026\", \"*\", \"?\", \"%\"",
    "canBeEmptyString": true
  },
  {
    "type": "TEXT",
    "name": "callback",
    "displayName": "Optional Callback Function",
    "simpleValueType": true,
    "help": "callback functions are allowed to start with: \"$\", \"_\", or \"a-z\" characters, followed by \"a-z\" and \"0-9\" characters.",
    "canBeEmptyString": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^$|^[_$a-zA-Z][_$a-zA-Z0-9]*$"
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const EUC = require('encodeUriComponent');
const Math = require('Math');
const generateRandom = require('generateRandom');
const instance_id = data.instanceID;
const source = data.source;
const campaign = data.campaign;
const callback = data.callback;
var url = 'https://script.anura.io/request.js';

if(data.hasOwnProperty("instanceID")) {
  url = url + '?instance=' + EUC(instance_id);
}
if(data.hasOwnProperty("source")) {
  url = url + "&source=" + EUC(source);
}
if(data.hasOwnProperty("campaign")) {
  url = url + "&campaign=" + EUC(campaign);
}
if(data.hasOwnProperty("callback")) {
  url = url + "&callback=" + EUC(callback);
}

const cacheBuster = generateRandom(1111111111111111, 9999999999999999);
url = url + "&" + cacheBuster;

function onSuccess() {
  data.gtmOnSuccess();
}
function onFailure () {
  data.gtmOnFailure();
}
if (queryPermission('inject_script', url) && instance_id) {
  injectScript(url, onSuccess, onFailure);
} else {
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://script.anura.io/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test 1
  code: |-
    const mockData = {
      // Mocked field values
      "instance_id":"2227668113",
      "source":"mysource",
      "campaign":"mycampaign",
      "callback":"mycallbackfunction"
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    //assertApi('gtmOnSuccess').wasCalled(); //cannnot use this line to test as instances are referrer locked this specific instance id is locked to vincentkahn.com/testing_tag/ and successfully runs on my sample site http://vincentkahn.com/testing_tag/basic.html
setup: ''


___NOTES___

Created on 5/27/2020, 9:41:51 AM


